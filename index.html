<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Límites de la Diócesis de El Alto</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <!-- Leaflet CDN con integridad -->
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5n/N0ZDvEg=" crossorigin="anonymous"/>
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js" integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo=" crossorigin="anonymous"></script>
  
  <style>
    body { margin: 0; padding: 0; font-family: Arial, Helvetica, sans-serif; }
    #map { height: 100vh; width: 100%; }
    .info { 
      padding: 6px 8px; 
      font: 14px/16px Arial, Helvetica, sans-serif; 
      background: white; 
      background: rgba(255,255,255,0.8); 
      box-shadow: 0 0 15px rgba(0,0,0,0.2); 
      border-radius: 5px; 
    }
    .legend i { 
      width: 18px; 
      height: 18px; 
      float: left; 
      margin-right: 8px; 
      opacity: 0.7; 
    }
  </style>
</head>
<body>
  <div id="map"></div>

  <script>
    // Inicializar mapa centrado en El Alto / Lago Titicaca
    var map = L.map('map').setView([-16.0, -68.3], 8);

    // Capa base OpenStreetMap
    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
      attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'
    }).addTo(map);

    // Estilo para las provincias
    function style(feature) {
      const diocesisProv = [
        'Muñecas', 'Camacho', 'Manco Kapac', 'Omasuyos', 'Los Andes', 'Ingavi'
      ];
      const provName = feature.properties.NAME_2 || '';

      if (diocesisProv.includes(provName) || provName === 'Murillo') {
        return {
          fillColor: '#FF6347',
          weight: 2,
          opacity: 1,
          color: 'white',
          dashArray: '3',
          fillOpacity: 0.7
        };
      }
      return {
        fillColor: '#A9A9A9',
        weight: 1,
        opacity: 0.8,
        color: 'white',
        fillOpacity: 0.3
      };
    }

    // Popup al hacer clic
    function onEachFeature(feature, layer) {
      const provName = feature.properties.NAME_2 || 'Provincia desconocida';
      let popup = `<b>${provName}</b><br>`;

      if (['Muñecas','Camacho','Manco Kapac','Omasuyos','Los Andes','Ingavi'].includes(provName)) {
        popup += 'Pertenece completamente a la Diócesis de El Alto.';
      } else if (provName === 'Murillo') {
        popup += 'Parte altiplánica (El Alto, Zongo, Achocalla parcial) pertenece a la Diócesis de El Alto.';
      } else {
        popup += 'Fuera de la Diócesis de El Alto.';
      }

      layer.bindPopup(popup);
    }

    // Cargar el GeoJSON que ya tienes subido
    fetch('gadm41_BOL_2.json')
      .then(response => {
        if (!response.ok) {
          throw new Error(`No se pudo cargar gadm41_BOL_2.json (código ${response.status})`);
        }
        return response.json();
      })
      .then(data => {
        L.geoJSON(data, {
          style: style,
          onEachFeature: onEachFeature
        }).addTo(map);
        console.log('GeoJSON cargado correctamente. Provincias:', data.features.length);
      })
      .catch(error => {
        console.error('Error al cargar GeoJSON:', error);
        const errorDiv = document.createElement('div');
        errorDiv.style.position = 'absolute';
        errorDiv.style.top = '10px';
        errorDiv.style.left = '50%';
        errorDiv.style.transform = 'translateX(-50%)';
        errorDiv.style.background = 'rgba(255,0,0,0.8)';
        errorDiv.style.color = 'white';
        errorDiv.style.padding = '10px 20px';
        errorDiv.style.borderRadius = '8px';
        errorDiv.style.zIndex = '1000';
        errorDiv.innerHTML = 'Error cargando límites provinciales: ' + error.message;
        document.body.appendChild(errorDiv);
      });

    // Leyenda
    var legend = L.control({position: 'bottomright'});
    legend.onAdd = function () {
      var div = L.DomUtil.create('div', 'info legend');
      div.innerHTML += '<i style="background:#FF6347"></i> Diócesis de El Alto<br>';
      div.innerHTML += '<i style="background:#A9A9A9"></i> Otras provincias<br>';
      return div;
    };
    legend.addTo(map);
  </script>
</body>
</html>
